name: distributed-webserver

topology:
    nodes:
        lb: # load balancer
            kind: linux
            image: nginx:alpine
            binds:
                - ./config/nginx.conf:/etc/nginx/nginx.conf
            ports:
                - 8080:80 # Expose port 80 of the load balancer to port 8080 on the host
            exec:
                -  # start nginx

        web1: # webserver 1
            kind: linux
            image: alpine:latest
            binds:
                - ./config/webserver1.sh:/config/webserver1.sh
                - ./config/web.c:/config/web.c
            cmd: sh /config/webserver1.sh
            ports:
                - 8081:80 # Expose port 80 of webserver 1 to port 8081 on the host
        web2: # webserver 2
            kind: linux
            image: alpine:latest
            binds:
                - ./config/webserver2.sh:/config/webserver2.sh
                - ./config/web.c:/config/web.c
            cmd: sh /config/webserver2.sh
            ports:
                - 8082:80 # Expose port 80 of webserver 2 to port 8082 on the host
        switch:
            kind: linux
            image: frrouting/frr:latest
            binds:
                - ./config:/config
            exec:
                - sh /config/config.switch.sh

    links:
        - endpoints: ["lb:eth1", "switch:eth1"]
        - endpoints: ["web1:eth1", "switch:eth2"]
        - endpoints: ["web2:eth1", "switch:eth3"]
